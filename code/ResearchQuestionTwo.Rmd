---
title: "Research Question 2: Does pubertal development relate to internalizing symptoms?"
date: "August 2020"
output:
  html_document: default
  pdf_document: default
authors: Natalie Saragosa-Harris 
---

``` {r loadPackages, echo = FALSE, message=FALSE, warning=FALSE}
#install.packages("gamm4.test")
#install.packages("mgcv")
install.packages("gamm4")

library(ggplot2)
library(gamm4)
library(dplyr)
library(sjPlot)
library(lmerTest)
library(here)
library(gamm4.test)
library(mgcv)
```

```{r LoadData, echo = FALSE}

# Elizabeth.
# Data: Desktop⁩ ▸ ⁨ABCD⁩ ▸ ⁨derivatives⁩ ▸ ⁨exploratory⁩
# Code: Desktop⁩ ▸ ⁨rewardprocesses_internalizing_puberty_exploratory⁩ ▸ ⁨code⁩

# Lucia.
# Data:  Github⁩ ▸ ⁨ABCD⁩ ▸ ⁨derivatives⁩ ▸ ⁨exploratory⁩
# Code:  Github ▸ ⁨rewardprocesses_internalizing_puberty_exploratory⁩ ▸ ⁨code

# Natalie.
# Data:  Desktop ▸ ABCD⁩ ▸ ⁨ABCD⁩ ▸ ⁨derivatives⁩ ▸ ⁨exploratory⁩
# Code:  Desktop ▸ ABCD ⁩▸ ⁨rewardprocesses_internalizing_puberty_exploratory⁩ ▸ ⁨code

# LMW alternative to read in the data.

data_dir = ((dirname(here()))) 

phase_folder = "exploratory"  # select the appropiate folder.
#phase_folder = "confirmatory"  # select the appropiate folder.

data_folder <- file.path(data_dir,"ABCD","derivatives",phase_folder)

file_name <- "nda20_exploratory.csv" # specify file name here. 

fulldata <- read.csv(file.path(data_folder,file_name))
length(fulldata$src_subject_id) # 5934.

# Call function to define all of the dataframes.
script_path <- file.path(data_dir,"rewardprocesses_internalizing_puberty_exploratory","code","define_dataframes.R")
source(script_path)

```

# Are there general gender differences in CBCL scores?
```{r CBCLDescriptives, echo = FALSE}
# Use data with only correct PDS scores, excluding CBCL outliers.
dataformodel <- data_no_CBCL_outliers
females <- data_no_CBCL_outliers_females
males <- data_no_CBCL_outliers_males

# Get an idea of the sample.
mean(dataformodel$cbcl_scr_syn_internal_r,na.rm= TRUE) # 4.632707.
mean(females$cbcl_scr_syn_internal_r,na.rm= TRUE) # 4.633761.
mean(males$cbcl_scr_syn_internal_r,na.rm= TRUE) # 4.631703.
min(females$cbcl_scr_syn_internal_r,na.rm= TRUE) # 0.0.
min(males$cbcl_scr_syn_internal_r,na.rm= TRUE) # 0.0.
t.test(males$cbcl_scr_syn_internal_r,females$cbcl_scr_syn_internal_r) # Not significant.

```

# Plot data.
## CBCL internalizing factor ~ Pubertal stage
```{r Confirmatory2, echo = FALSE}
# Excluding CBCL outliers.
dataformodel <- data_no_CBCL_outliers

ggplot(dataformodel, aes(x=PDS_score, y = cbcl_scr_syn_internal_r, group = src_subject_id, color=sex, fill = sex)) +
  geom_point(size = 4, alpha = 0.8,position = position_jitterdodge()) +
  scale_color_manual(values = c("#7BACAB", "gray40"), labels = c("Female", "Male"), name = "Sex") +
  scale_fill_manual(values = c("#7BACAB", "gray40"), labels = c("Female", "Male"), name = "Sex") +
  ylab("CBCL Internalizing") +
  xlab("PDS Score")

```

# Confirmatory Hypothesis 2: We hypothesize that advanced pubertal stage will be associated with higher internalizing symptoms as measured by the Child Behavior Checklist (CBCL) internalizing factor (Ullsperger & Nikolas, 2017).

## Model: CBCL internalizing factor ~ Pubertal stage
```{r Confirmatory2, echo = FALSE}
# Excluding CBCL outliers.

dataformodel <- data_no_CBCL_outliers

confirmatory2 <- gamm4(cbcl_scr_syn_internal_r ~ PDS_score +
                      race.ethnicity.5level +
                      high.educ +
                      household.income +
                      married.or.livingtogether +
                      interview_age +
                      demo_race_hispanic, 
                      data = dataformodel, 
                      random = ~ (1 | site_id_l/rel_family_id))
                      

summary(confirmatory2$gam)

#TESTING PDS CATEGORY (instead of continuous)
confirmatory2_category <- gamm4(cbcl_scr_syn_internal_r ~ pds_p_ss_category +
                      race.ethnicity.5level +
                      high.educ +
                      household.income +
                      married.or.livingtogether +
                      interview_age +
                      demo_race_hispanic, 
                      data = dataformodel, 
                      random = ~ (1 | site_id_l/rel_family_id))
                      

summary(confirmatory2_category$gam)

```

### Quick plots
```{r}
#Quick plots



plot_model(confirmatory2$mer,type = "pred", show.data = FALSE) #Interaction plot

plot_model(confirmatory2,type = "std", show.data = FALSE) #Forest plot with standarized coefficients
```


### Are there gender differences in this effect?
```{r}
dataformodel <- data_no_CBCL_outliers

confirmatory2_gender <- gamm4(cbcl_scr_syn_internal_r ~ PDS_score*sex +
                      race.ethnicity.5level +
                      high.educ +
                      household.income +
                      married.or.livingtogether +
                      interview_age +
                      demo_race_hispanic, 
                      data = dataformodel,
                      random = ~(1 | site_id_l/rel_family_id))
                      


summary(confirmatory2_gender$gam)


#TESTING PDS CATEGORY
confirmatory2_gender_category <- gamm4(cbcl_scr_syn_internal_r ~ pds_p_ss_category*sex +
                      race.ethnicity.5level +
                      high.educ +
                      household.income +
                      married.or.livingtogether +
                      interview_age +
                      demo_race_hispanic, 
                      data = dataformodel,
                      random = ~(1 | site_id_l/rel_family_id))
                      


summary(confirmatory2_gender_category$gam)
```

#### Quick plots
```{r}
#Quick plots
plot_model(confirmatory2_gender,type = "int", show.data = FALSE) #Interaction plot

plot_model(confirmatory2_gender,type = "std", show.data = FALSE) #Forest plot with standarized coefficients
```

### Female
```{r}
dataformodel <- data_no_CBCL_outliers_females

confirmatory2_female <- gamm4(cbcl_scr_syn_internal_r ~ PDS_score +
                      race.ethnicity.5level +
                      high.educ +
                      household.income +
                      married.or.livingtogether +
                      interview_age +
                      demo_race_hispanic,
                      data = dataformodel,
                      random = ~(1 | site_id_l/rel_family_id))
            
summary(confirmatory2_female$gam)

#TESTING PDS CATEGORY
confirmatory2_female_category <- gamm4(cbcl_scr_syn_internal_r ~ pds_p_ss_category +
                      race.ethnicity.5level +
                      high.educ +
                      household.income +
                      married.or.livingtogether +
                      interview_age +
                      demo_race_hispanic,
                      data = dataformodel,
                      random = ~(1 | site_id_l/rel_family_id))
            
summary(confirmatory2_female_category$gam)
```

#### Quick plots
```{r}
#Quick plots
plot_model(confirmatory2_female,type = "pred", show.data = TRUE) #Interaction plot

plot_model(confirmatory2_female,type = "std", show.data = TRUE) #Forest plot with standarized coefficients
```

### Male
```{r}
dataformodel <- data_no_CBCL_outliers_males

confirmatory2_male <- gamm4(cbcl_scr_syn_internal_r ~ PDS_score +
                      race.ethnicity.5level +
                      high.educ +
                      household.income +
                      married.or.livingtogether +
                      interview_age +
                      demo_race_hispanic,
                      data = dataformodel,
                      random = ~(1 | site_id_l/rel_family_id))
                      
summary(confirmatory2_male$gam)

#TESTING PDS CATEGORY
confirmatory2_male_category <- gamm4(cbcl_scr_syn_internal_r ~ pds_p_ss_category +
                      race.ethnicity.5level +
                      high.educ +
                      household.income +
                      married.or.livingtogether +
                      interview_age +
                      demo_race_hispanic,
                      data = dataformodel,
                      random = ~(1 | site_id_l/rel_family_id))
                      
summary(confirmatory2_male_category$gam)
```

#### Quick plots
```{r}
#Quick plots
plot_model(confirmatory2_male,type = "pred", show.data = FALSE) #Interaction plot

plot_model(confirmatory2_male,type = "std", show.data = FALSE) #Forest plot with standarized coefficients
```



# Exploratory Hypothesis 2: We will investigate whether testosterone relates to internalizing symptoms and whether this relationship is present after controlling for PDS.
## Model A: CBCL internalizing factor ~ Testosterone
```{r Exploratory2A, echo = FALSE}
PDS_correct$hormone_scr_ert_mean_z <- scale(PDS_correct$hormone_scr_ert_mean)
PDS_correct$cbcl_scr_syn_internal_r_z <- scale(PDS_correct$cbcl_scr_syn_internal_r)

PDS_correct_females$hormone_scr_ert_mean_z <- scale(PDS_correct_females$hormone_scr_ert_mean)
PDS_correct_females$cbcl_scr_syn_internal_r_z <- scale(PDS_correct_females$cbcl_scr_syn_internal_r)

PDS_correct_males$hormone_scr_ert_mean_z <- scale(PDS_correct_males$hormone_scr_ert_mean)
PDS_correct_males$cbcl_scr_syn_internal_r_z <- scale(PDS_correct_males$cbcl_scr_syn_internal_r)


data_no_CBCL_test_outliers <- subset(PDS_correct, hormone_scr_ert_mean_z > -3 & hormone_scr_ert_mean_z < 3 & cbcl_scr_syn_internal_r_z > -3 & cbcl_scr_syn_internal_r_z < 3)

data_no_CBCL_test_outliers_females <- subset(PDS_correct_females, hormone_scr_ert_mean_z > -3 & hormone_scr_ert_mean_z < 3 & cbcl_scr_syn_internal_r_z > -3 & cbcl_scr_syn_internal_r_z < 3)

data_no_CBCL_test_outliers_males <- subset(PDS_correct_males, hormone_scr_ert_mean_z > -3 & hormone_scr_ert_mean_z < 3 & cbcl_scr_syn_internal_r_z > -3 & cbcl_scr_syn_internal_r_z < 3)

# Get an idea of the sample.

mean(data_no_CBCL_test_outliers$hormone_scr_ert_mean_z,na.rm= TRUE) 
mean(data_no_CBCL_test_outliers_females$hormone_scr_ert_mean_z,na.rm= TRUE) 

mean(data_no_CBCL_test_outliers_males$hormone_scr_ert_mean_z,na.rm= TRUE) 

min(data_no_CBCL_test_outliers_females$hormone_scr_ert_mean_z,na.rm= TRUE)

min(data_no_CBCL_test_outliers_males$hormone_scr_ert_mean_z,na.rm= TRUE) 

t.test(data_no_CBCL_test_outliers_males$hormone_scr_ert_mean_z,data_no_CBCL_test_outliers_females$hormone_scr_ert_mean_z)
```

```{r}
dataformodel <- data_no_CBCL_test_outliers

confirmatory2_testosterone_CBCL <- gamm4(cbcl_scr_syn_internal_r ~ hormone_scr_ert_mean_z +
                      race.ethnicity.5level +
                      high.educ +
                      household.income +
                      married.or.livingtogether +
                      interview_age +
                      demo_race_hispanic,
                      #fam_history_q6d_depression + #added mother's depression
                      data = dataformodel,
                      random = ~(1 | site_id_l/rel_family_id))
                      
summary(confirmatory2_testosterone_CBCL$gam)
```

### Gender Differences
#### Female
```{r}
dataformodel <- data_no_CBCL_test_outliers_females

confirmatory2_testosterone_CBCL_female <- gamm4(cbcl_scr_syn_internal_r ~ hormone_scr_ert_mean_z +
                      race.ethnicity.5level +
                      high.educ +
                      household.income +
                      married.or.livingtogether +
                      interview_age +
                      demo_race_hispanic,
                      #fam_history_q6d_depression + #added mother's depression
                      data = dataformodel,
                      random = ~ (1 | site_id_l/rel_family_id))
                      
summary(confirmatory2_testosterone_CBCL_female$gam)
```

#### Male
```{r}
dataformodel <- data_no_CBCL_test_outliers_males

confirmatory2_testosterone_CBCL_male <- gamm4(cbcl_scr_syn_internal_r ~ hormone_scr_ert_mean_z +
                      race.ethnicity.5level +
                      high.educ +
                      household.income +
                      married.or.livingtogether +
                      interview_age +
                      demo_race_hispanic,
                      #fam_history_q6d_depression + #added mother's depression
                      data = dataformodel,
                      random = ~ (1 | site_id_l/rel_family_id))
                      
summary(confirmatory2_testosterone_CBCL_male$gam)
```

## Model B: CBCL internalizing factor ~ Testosterone + Pubertal stage 
#### Female
```{r Exploratory2B, echo = FALSE}

dataformodel <- data_no_CBCL_test_outliers_females

confirmatory2B_testosterone_CBCL_female <- gamm4(cbcl_scr_syn_internal_r ~ hormone_scr_ert_mean_z + PDS_score +
                      race.ethnicity.5level +
                      high.educ +
                      household.income +
                      married.or.livingtogether +
                      interview_age +
                      demo_race_hispanic,
                      #fam_history_q6d_depression + #added mother's depression
                      data = dataformodel,  
                      random = ~ (1 | site_id_l/rel_family_id))
                      
summary(confirmatory2B_testosterone_CBCL_female$gam)


#TESTING PDS CATEGORY
confirmatory2B_testosterone_CBCL_female_category <- gamm4(cbcl_scr_syn_internal_r ~ hormone_scr_ert_mean_z + pds_p_ss_category +
                      race.ethnicity.5level +
                      high.educ +
                      household.income +
                      married.or.livingtogether +
                      interview_age +
                      demo_race_hispanic,
                      #fam_history_q6d_depression + #added mother's depression
                      data = dataformodel,  
                      random = ~ (1 | site_id_l/rel_family_id))
                      
summary(confirmatory2B_testosterone_CBCL_female_category$gam)
```

#### Male
```{r}
dataformodel <- data_no_CBCL_test_outliers_males

confirmatory2B_testosterone_CBCL_male <- gamm4(cbcl_scr_syn_internal_r ~ hormone_scr_ert_mean_z + PDS_score +
                      race.ethnicity.5level +
                      high.educ +
                      household.income +
                      married.or.livingtogether +
                      interview_age +
                      demo_race_hispanic,
                      #fam_history_q6d_depression + #added mother's depression
                      data = dataformodel,
                      random = ~ (1 | site_id_l/rel_family_id))
                      
summary(confirmatory2B_testosterone_CBCL_male$gam)

#TESTING PDS CATEGORY
confirmatory2B_testosterone_CBCL_male_category <- gamm4(cbcl_scr_syn_internal_r ~ hormone_scr_ert_mean_z + pds_p_ss_category +
                      race.ethnicity.5level +
                      high.educ +
                      household.income +
                      married.or.livingtogether +
                      interview_age +
                      demo_race_hispanic,
                      #fam_history_q6d_depression + #added mother's depression
                      data = dataformodel,
                      random = ~ (1 | site_id_l/rel_family_id))
                      
summary(confirmatory2B_testosterone_CBCL_male_category$gam)
```

