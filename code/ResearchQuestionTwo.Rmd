---
title: "Research Question 2: Does pubertal development relate to internalizing symptoms?"
date: "August 2020"
output:
  html_document: default
  pdf_document: default
authors: Natalie Saragosa-Harris 
---

``` {r loadPackages, echo = FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
library(gamm4)
library(dplyr)
library(sjPlot)
library(lmerTest)
library(here)
```

```{r LoadData, echo = FALSE}

# Elizabeth.
# Data: Desktop⁩ ▸ ⁨ABCD⁩ ▸ ⁨derivatives⁩ ▸ ⁨exploratory⁩
# Code: Desktop⁩ ▸ ⁨rewardprocesses_internalizing_puberty_exploratory⁩ ▸ ⁨code⁩

# Lucia.
# Data:  Github⁩ ▸ ⁨ABCD⁩ ▸ ⁨derivatives⁩ ▸ ⁨exploratory⁩
# Code:  Github ▸ ⁨rewardprocesses_internalizing_puberty_exploratory⁩ ▸ ⁨code

# Natalie.
# Data:  Desktop ▸ ABCD⁩ ▸ ⁨ABCD⁩ ▸ ⁨derivatives⁩ ▸ ⁨exploratory⁩
# Code:  Desktop ▸ ABCD ⁩▸ ⁨rewardprocesses_internalizing_puberty_exploratory⁩ ▸ ⁨code

# LMW alternative to read in the data.

data_dir = ((dirname(here()))) 

phase_folder = "exploratory"  # select the appropiate folder.
#phase_folder = "confirmatory"  # select the appropiate folder.

data_folder <- file.path(data_dir,"ABCD","derivatives",phase_folder)

file_name <- "nda20_exploratory.csv" # specify file name here. 

fulldata <- read.csv(file.path(data_folder,file_name))
length(fulldata$src_subject_id) # 5934.

# Call function to define all of the dataframes.
script_path <- file.path(data_dir,"rewardprocesses_internalizing_puberty_exploratory","code","define_dataframes.R")
source(script_path)

```

# Are there general gender differences in CBCL scores?
```{r CBCLDescriptives, echo = FALSE}
# Use data with only correct PDS scores, excluding CBCL outliers.
dataformodel <- data_no_CBCL_outliers
females <- data_no_CBCL_outliers_females
males <- data_no_CBCL_outliers_males

# Get an idea of the sample.
mean(dataformodel$cbcl_scr_syn_internal_r,na.rm= TRUE) # 4.632707.
mean(females$cbcl_scr_syn_internal_r,na.rm= TRUE) # 4.633761.
mean(males$cbcl_scr_syn_internal_r,na.rm= TRUE) # 4.631703.
min(females$cbcl_scr_syn_internal_r,na.rm= TRUE) # 0.0.
min(males$cbcl_scr_syn_internal_r,na.rm= TRUE) # 0.0.
t.test(males$cbcl_scr_syn_internal_r,females$cbcl_scr_syn_internal_r) # Not significant.

```

# Plot data.
## CBCL internalizing factor ~ Pubertal stage
```{r Confirmatory2, echo = FALSE}
# Excluding CBCL outliers.
dataformodel <- data_no_CBCL_outliers

ggplot(dataformodel, aes(x=PDS_score, y = cbcl_scr_syn_internal_r, group = src_subject_id, color=sex, fill = sex)) +
  geom_point(size = 4, alpha = 0.8,position = position_jitterdodge()) +
  scale_color_manual(values = c("#7BACAB", "gray40"), labels = c("Female", "Male"), name = "Sex") +
  scale_fill_manual(values = c("#7BACAB", "gray40"), labels = c("Female", "Male"), name = "Sex") +
  ylab("CBCL Internalizing") +
  xlab("PDS Score") +
  nsh_theme


```

# Confirmatory Hypothesis 2: We hypothesize that advanced pubertal stage will be associated with higher internalizing symptoms as measured by the Child Behavior Checklist (CBCL) internalizing factor (Ullsperger & Nikolas, 2017).

## Model: CBCL internalizing factor ~ Pubertal stage
```{r Confirmatory2, echo = FALSE}
# Excluding CBCL outliers.

dataformodel <- data_no_CBCL_outliers

confirmatory2 <- lmer(cbcl_scr_syn_internal_r ~ PDS_score +
                      race.ethnicity.5level +
                      high.educ +
                      household.income +
                      married.or.livingtogether +
                      interview_age +
                      demo_race_hispanic +
                      (1 | site_id_l/rel_family_id),
                      data = dataformodel)
summary(confirmatory2)
```

### Quick plots
```{r}
#Quick plots
plot_model(confirmatory2,type = "pred", show.data = FALSE) #Interaction plot

plot_model(confirmatory2,type = "std", show.data = FALSE) #Forest plot with standarized coefficients
```

```
# (1 | site_id_l/mri_info_deviceserialnumber/rel_family_id)
# (1 | mri_info_deviceserialnumber/rel_family_id)


# predicteddata <- get_model_data(confirmatory2,type = "pred", terms = "PDS_score")

#geom_segment(aes(x = -4, xend = 4, 
#                     y = fixedeffect_intercept + fixedeffect_slope*-4, yend = fixedeffect_intercept + fixedeffect_slope*4), # size = 2,  color = "black") +


#plot_model(confirmatory2,type = "pred", terms = "PDS_score", 
           show.data = TRUE, jitter = 0.1, line.size = 2) +
   ylab("Internalizing Score") +
   xlab("PDS Stage") +
   scale_y_continuous(breaks = seq(0, 100, by = 10), limits = c(30,100)) +
   theme(title= element_text(size=26, vjust=2, face="bold"),
         plot.title = element_blank(),
         axis.title.x= element_text(size=18, vjust=-0.3),
         axis.title.y= element_text(size=18, vjust=1.5),
         axis.text.x= element_text(size=18, colour="black"),
         axis.text.y= element_text(size=18, colour="black"),
         legend.position="none",
         strip.text = element_text(size=24, face="bold"),
         panel.background = element_blank(),
         axis.line = element_line(colour = "black"))
```

### Are there gender differences in this effect?
```{r}
dataformodel <- data_no_CBCL_outliers

confirmatory2_gender <- lmer(cbcl_scr_syn_internal_r ~ PDS_score*sex +
                      race.ethnicity.5level +
                      high.educ +
                      household.income +
                      married.or.livingtogether +
                      interview_age +
                      demo_race_hispanic +
                      (1 | site_id_l/rel_family_id),
                      data = dataformodel)
summary(confirmatory2_gender)
```

#### Quick plots
```{r}
#Quick plots
plot_model(confirmatory2_gender,type = "int", show.data = FALSE) #Interaction plot

plot_model(confirmatory2_gender,type = "std", show.data = FALSE) #Forest plot with standarized coefficients
```

### Female
```{r}
dataformodel <- data_no_CBCL_outliers_females

confirmatory2_female <- lmer(cbcl_scr_syn_internal_r ~ PDS_score +
                      race.ethnicity.5level +
                      high.educ +
                      household.income +
                      married.or.livingtogether +
                      interview_age +
                      demo_race_hispanic +
                      (1 | site_id_l/rel_family_id),
                      data = dataformodel)
summary(confirmatory2_female)
```

#### Quick plots
```{r}
#Quick plots
plot_model(confirmatory2_female,type = "pred", show.data = FALSE) #Interaction plot

plot_model(confirmatory2_female,type = "std", show.data = FALSE) #Forest plot with standarized coefficients
```

### Male
```{r}
dataformodel <- data_no_CBCL_outliers_males

confirmatory2_male <- lmer(cbcl_scr_syn_internal_r ~ PDS_score +
                      race.ethnicity.5level +
                      high.educ +
                      household.income +
                      married.or.livingtogether +
                      interview_age +
                      demo_race_hispanic +
                      (1 | site_id_l/rel_family_id),
                      data = dataformodel)
summary(confirmatory2_male)
```

#### Quick plots
```{r}
#Quick plots
plot_model(confirmatory2_male,type = "pred", show.data = FALSE) #Interaction plot

plot_model(confirmatory2_male,type = "std", show.data = FALSE) #Forest plot with standarized coefficients
```



# Exploratory Hypothesis 2: We will investigate whether testosterone relates to internalizing symptoms and whether this relationship is present after controlling for PDS.
## Model A: CBCL internalizing factor ~ Testosterone
```{r Exploratory2A, echo = FALSE}
# Get an idea of the sample.

mean(data_no_CBCL_test_outliers$hormone_scr_ert_mean_z,na.rm= TRUE) 
mean(data_no_CBCL_test_outliers_females$hormone_scr_ert_mean_z,na.rm= TRUE) 

mean(data_no_CBCL_test_outliers_males$hormone_scr_ert_mean_z,na.rm= TRUE) 

min(data_no_CBCL_test_outliers_females$hormone_scr_ert_mean_z,na.rm= TRUE)

min(data_no_CBCL_test_outliers_males$hormone_scr_ert_mean_z,na.rm= TRUE) 

t.test(data_no_CBCL_test_outliers_males$hormone_scr_ert_mean_z,data_no_CBCL_test_outliers_females$hormone_scr_ert_mean_z)
```

```{r}
dataformodel <- data_no_CBCL_test_outliers

confirmatory2_testosterone_CBCL <- lmer(cbcl_scr_syn_internal_r ~ hormone_scr_ert_mean_z +
                      race.ethnicity.5level +
                      high.educ +
                      household.income +
                      married.or.livingtogether +
                      interview_age +
                      demo_race_hispanic +
                      #fam_history_q6d_depression + #added mother's depression
                      (1 | site_id_l/rel_family_id),
                      data = dataformodel)
summary(confirmatory2_testosterone_CBCL)
```

### Gender Differences
#### Female
```{r}
dataformodel <- data_no_CBCL_test_outliers_females

confirmatory2_testosterone_CBCL_female <- lmer(cbcl_scr_syn_internal_r ~ hormone_scr_ert_mean_z +
                      race.ethnicity.5level +
                      high.educ +
                      household.income +
                      married.or.livingtogether +
                      interview_age +
                      demo_race_hispanic +
                      #fam_history_q6d_depression + #added mother's depression
                      (1 | site_id_l/rel_family_id),
                      data = dataformodel)
summary(confirmatory2_testosterone_CBCL_female)
```

#### Male
```{r}
dataformodel <- data_no_CBCL_test_outliers_males

confirmatory2_testosterone_CBCL_male <- lmer(cbcl_scr_syn_internal_r ~ hormone_scr_ert_mean_z +
                      race.ethnicity.5level +
                      high.educ +
                      household.income +
                      married.or.livingtogether +
                      interview_age +
                      demo_race_hispanic +
                      #fam_history_q6d_depression + #added mother's depression
                      (1 | site_id_l/rel_family_id),
                      data = dataformodel)
summary(confirmatory2_testosterone_CBCL_male)
```

## Model B: CBCL internalizing factor ~ Testosterone + Pubertal stage 
#### Female
```{r Exploratory2B, echo = FALSE}

dataformodel <- data_no_CBCL_test_outliers_females

confirmatory2B_testosterone_CBCL_female <- lmer(cbcl_scr_syn_internal_r ~ hormone_scr_ert_mean_z + PDS_score +
                      race.ethnicity.5level +
                      high.educ +
                      household.income +
                      married.or.livingtogether +
                      interview_age +
                      demo_race_hispanic +
                      #fam_history_q6d_depression + #added mother's depression
                      (1 | site_id_l/rel_family_id),
                      data = dataformodel)
summary(confirmatory2B_testosterone_CBCL_female)
```

#### Male
```{r}
dataformodel <- data_no_CBCL_test_outliers_males

confirmatory2B_testosterone_CBCL_male <- lmer(cbcl_scr_syn_internal_r ~ hormone_scr_ert_mean_z + PDS_score +
                      race.ethnicity.5level +
                      high.educ +
                      household.income +
                      married.or.livingtogether +
                      interview_age +
                      demo_race_hispanic +
                      #fam_history_q6d_depression + #added mother's depression
                      (1 | site_id_l/rel_family_id),
                      data = dataformodel)
summary(confirmatory2B_testosterone_CBCL_male)
```

