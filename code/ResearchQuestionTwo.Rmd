---
title: "Research Question 2: Does pubertal development relate to internalizing symptoms?"
date: "August 2020"
output:
  html_document: default
  pdf_document: default
authors: Natalie Saragosa-Harris 
---
``` {r loadPackages, echo = FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
library(gamm4)
library(dplyr)
library(sjPlot)
```

```{r setdirectories, echo = FALSE}
# Change this to your directory and the name of your data file.
datapath <- "/Users/nataliesaragosa-harris/Desktop/ABCD/output"
datafile <- "nda20_exploratory.csv"
setwd(datapath)

# Covariates.
#      Random effects.
#           1. Family. (rel_family_id) # Make sure this is nested correctly and looks about right.
#           2. Site. (site_id_l)
#           3. Subject. (src_subject_id) # There is only one timepoint so we cannot do a random effect for each participant.
#           4. Device. # mri_info_deviceserialnumber.

          #  Random effects are nested: (1|abcd_site/device/rel_family_id) [unless some siblings went in different scanners?]

#      Fixed effects.
#           1. Race parent. (race.eth.7level).
#           2. Education parent. (high.educ).
#           3. Income parent. (household.income)
#           4. Marital status parent. (married.or.livingtogether)
#           5. Age. (interview_age).
#           6. Hispanic. (demo_race_hispanic).
#           7. Maternal Depression (Yes/No). (fam_history_q6d_depression). This is specific to the mother; do we want
#              to use the one about the family history in general?

```

```{r GetData, echo = FALSE}
fulldata <- read.table(datafile, header=T, sep=",",as.is=TRUE,strip.white=TRUE,fill=TRUE)
length(fulldata$src_subject_id) # 5934.
# Because this is such a big data file, let's only keep the columns that we need for this analysis.
data <- fulldata[,c("src_subject_id",
                "interview_age",
                "eventname",
                "sex",
                "site_id_l",
                "mri_info_deviceserialnumber",
                "rel_family_id",
                "race.ethnicity.5level",
                "race.eth.7level",
                "demo_race_hispanic", # Do you consider the child Hispanic/Latino/Latina?
                "high.educ",
                "household.income",
                "married.or.livingtogether",
                "cbcl_scr_syn_internal_t",
                "cbcl_scr_syn_anxdep_t",
                "cbcl_scr_syn_withdep_t",
                "cbcl_scr_dsm5_depress_t",
                "PDS_score_f",
                "PDS_score_m",
                "PDS_score",
                "PDS_sum_f",
                "PDS_sum_m",
                "PDS_sum",
                "fam_history_q6d_depression",
                "tfmri_ma_acdn_b_scs_aarh", # Accumbens reward vs. neutral anticipation.
                "tfmri_ma_acdn_b_scs_aalh",
                "tfmri_ma_acdn_b_scs_cdrh", # Caudate reward vs. neutral anticipation.
                "tfmri_ma_acdn_b_scs_cdlh",
                "tfmri_ma_acdn_b_scs_ptrh", # Putamen reward vs. neutral anticipation.
                "tfmri_ma_acdn_b_scs_ptlh",
                "tfmri_ma_arvn_b_cds_mobofrrh", # Medial OFC reward vs. neutral anticipation.
                "tfmri_ma_arvn_b_cds_mobofrlh",
                "tfmri_ma_arvn_b_cds_lobofrrh", # Lateral OFC reward vs. neutral anticipation.
                "tfmri_ma_arvn_b_cds_lobofrlh",
                "tfmri_ma_rpvnfb_b_scs_aarh", # Accumbens reward positive versus negative feedback.
                "tfmri_ma_rpvnfb_b_scs_aalh",
                "tfmri_ma_rpvnfb_b_scs_cdrh", # Caudate reward positive versus negative feedback.
                "tfmri_ma_rpvnfb_b_scs_cdlh",
                "tfmri_ma_rpvnfb_b_scs_ptrh", # Putamen reward positive versus negative feedback.
                "tfmri_ma_rpvnfb_b_scs_ptlh",
                "tfmri_ma_rpvnfb_b_cds_mobofrrh", # Medial OFC reward positive versus negative feedback.
                "tfmri_ma_rpvnfb_b_cds_mobofrlh",
                "tfmri_ma_rpvnfb_b_cds_lobofrrh", # Lateral OFC reward positive versus negative feedback.
                "tfmri_ma_rpvnfb_b_cds_lobofrlh",
                "accumbens_rvsn_ant", # Reward vs. neutral during anticipation stage.
                "caudate_rvsn_ant",
                "putamen_rvsn_ant",
                "mOFC_rvsn_ant",
                "lOFC_rvsn_ant",
                "accumbens_posvsneg_feedback", # All positive vs. negative feedback.
                "caudate_posvsneg_feedback",
                "putamen_posvsneg_feedback",
                "mOFC_posvsneg_feedback",
                "lOFC_posvsneg_feedback",
                "striatum_rvsn_ant", # reward vs. neutral anticipation.
                "striatum_posvsneg_feedback"
                )]

data$src_subject_id <- as.factor(data$src_subject_id)
data$rel_family_id <- as.factor(data$rel_family_id)
data$eventname <- as.factor(data$eventname)
data$sex <- as.factor(data$sex)
data$demo_race_hispanic <- as.factor(data$demo_race_hispanic)
data$site_id_l <- as.factor(data$site_id_l)
data$mri_info_deviceserialnumber <- as.factor(data$mri_info_deviceserialnumber)
data$race.eth.7level <- as.factor(data$race.eth.7level)
data$high.educ <- as.factor(data$high.educ)
data$household.income <- as.factor(data$household.income)
data$married.or.livingtogether <- as.factor(data$married.or.livingtogether)

```


# Confirmatory Hypothesis 2: We hypothesize that advanced pubertal stage will be associated with higher internalizing symptoms as measured by the Child Behavior Checklist (CBCL) internalizing factor (Ullsperger & Nikolas, 2017).
## Model: CBCL internalizing factor ~ Pubertal stage
```{r Confirmatory2, echo = FALSE}
# Use data with only correct PDS scores.
PDS_correct <- subset(data, PDS_score < 5)

# Note that this formula does not have the random effects because I'm not sure exactly how to best include them.
confirmatory2 <- lm(cbcl_scr_syn_internal_t ~ PDS_score +
                      race.eth.7level +
                      high.educ +
                      household.income +
                      married.or.livingtogether +
                      interview_age +
                      demo_race_hispanic,
                      data = PDS_correct)
summary(confirmatory2)
# (1|site_id_l/rel_family_id), # Not sure how to write this part?

predicteddata <- get_model_data(confirmatory2,type = "pred", terms = "PDS_score")

 geom_segment(aes(x = -4, xend = 4, 
                     y = fixedeffect_intercept + fixedeffect_slope*-4, yend = fixedeffect_intercept + fixedeffect_slope*4), size = 2,  color = "black") +


plot_model(confirmatory2,type = "pred", terms = "PDS_score", 
           show.data = TRUE, jitter = 0.1, line.size = 2) +
   ylab("Internalizing Score") +
   xlab("PDS Stage") +
   scale_y_continuous(breaks = seq(0, 100, by = 10), limits = c(30,100)) +
   theme(title= element_text(size=26, vjust=2, face="bold"),
         plot.title = element_blank(),
         axis.title.x= element_text(size=18, vjust=-0.3),
         axis.title.y= element_text(size=18, vjust=1.5),
         axis.text.x= element_text(size=18, colour="black"),
         axis.text.y= element_text(size=18, colour="black"),
         legend.position="none",
         strip.text = element_text(size=24, face="bold"),
         panel.background = element_blank(),
         axis.line = element_line(colour = "black"))


```

# Exploratory Hypothesis 2: We will investigate whether testosterone relates to internalizing symptoms and whether this relationship is present after controlling for PDS.
## Model A: CBCL internalizing factor ~ Testosterone
## Model B: CBCL internalizing factor ~ Testosterone + Pubertal stage 
```{r Exploratory2, echo = FALSE}
# Use data with only correct PDS scores.
PDS_correct <- subset(data, PDS_score < 5)

```
